<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vinyl Estimator v2 (Google Sheets)</title>
  <style>
    body {
      margin:0;
      background:#f6f7f8;
      font:16px/1.4 system-ui;
    }
    /* Tabs (desktop) */
    .tabs {
      display:flex;
      gap:4px;
      padding:8px;
      background:#333;
    }
    .tab {
      flex:1;
      padding:12px;
      text-align:center;
      color:#dfe7ee;
      cursor:pointer;
      border-radius:8px;
      transition:background .3s;
    }
    .tab.active {background:#00796b;color:#fff;font-weight:600;}
    /* Container + Cards */
    .container{max-width:900px;margin:18px auto;padding:18px}
    .card{background:#fff;border:1px solid #d6dde5;border-radius:10px;padding:16px}
    h2{margin:0 0 12px}
    label{font-weight:600;display:block;margin:8px 0 4px}
    input,select,button,textarea{width:100%;padding:10px;font-size:16px;border:1px solid #d6dde5;border-radius:8px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .row > *{flex:1 1 180px}
    .result,.final{background:#e6f6ea;padding:12px;border-radius:8px;color:#2e7d32;font-weight:600}
    .materials-list{margin:8px 0 16px}
    .chip{background:#eef3ff;color:#284b8c;padding:2px 8px;border-radius:999px;font-size:12px}
    .mono{font-variant-numeric:tabular-nums}
    .muted{color:#5b6b7a}
    /* Hamburger button (mobile only) */
    .hamburger {
      display:none;
      width:40px;
      height:30px;
      margin:10px;
      position:relative;
      cursor:pointer;
      z-index:1100;
    }
    .hamburger span {
      position:absolute;
      height:4px;
      width:100%;
      background:#fff;
      border-radius:2px;
      left:0;
      transition:0.3s ease;
    }
    .hamburger span:nth-child(1){top:0;}
    .hamburger span:nth-child(2){top:13px;}
    .hamburger span:nth-child(3){top:26px;}
    .hamburger.active span:nth-child(1){
      transform:rotate(45deg);
      top:13px;
    }
    .hamburger.active span:nth-child(2){
      opacity:0;
    }
    .hamburger.active span:nth-child(3){
      transform:rotate(-45deg);
      top:13px;
    }
    /* Mobile menu drawer */
    .mobile-menu {
      position:fixed;
      top:0;left:-220px;
      width:200px;
      height:100%;
      background:#333;
      display:flex;
      flex-direction:column;
      padding-top:20px;
      transition:left 0.3s ease;
      z-index:1001;
    }
    .mobile-menu.show {left:0;}
    .mobile-menu .tab {
      flex:none;
      text-align:left;
      padding:14px 20px;
      border-bottom:1px solid #444;
      border-radius:0;
    }
    /* Background overlay */
    .overlay {
      position:fixed;
      top:0;left:0;
      width:100%;height:100%;
      background:rgba(0,0,0,0.5);
      opacity:0;
      pointer-events:none;
      transition:opacity 0.3s ease;
      z-index:1000;
    }
    .overlay.show {opacity:1;pointer-events:auto;}
    @media (max-width:700px) {
      .tabs {display:none;}  /* hide desktop tabs */
      .hamburger {display:block;} /* show hamburger */
    }
    .topbar {
      display:flex;
      align-items:center;
      background:#333;
      color:#fff;
      padding:8px;
    }
    .topbar h1 {
      font-size:18px;
      margin:0 auto;
    }
  </style>
</head>
<body>
  <!-- Desktop Tabs -->
  <div class="tabs">
    <div class="tab active" data-tab="estimator">Estimator</div>
    <div class="tab" data-tab="labor">Labor & Add-Ons</div>
    <div class="tab" data-tab="final">Final Quote</div>
    <div class="tab" data-tab="materials">Materials</div>
  </div>
  <!-- Mobile Topbar -->
  <div class="topbar">
    <div class="hamburger" id="hamburger">
      <span></span><span></span><span></span>
    </div>
    <h1>Estimator</h1>
  </div>
  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu">
    <div class="tab active" data-tab="estimator">Estimator</div>
    <div class="tab" data-tab="labor">Labor & Add-Ons</div>
    <div class="tab" data-tab="final">Final Quote</div>
    <div class="tab" data-tab="materials">Materials</div>
  </div>
  <div class="overlay" id="overlay"></div>

  <div class="container">
    <!-- ESTIMATOR -->
    <section id="estimator" class="card">
      <h2>Estimator: Vinyl + Laminate</h2>
      <div class="row">
        <button id="addDimBtn">+ Add Print Area</button>
        <button id="clearDimBtn">Clear</button>
      </div>
      <div id="dimensionList"></div>
      <label for="bleed">Bleed per side (in)</label>
      <input type="number" id="bleed" value="0" step="0.1"/>
      <label for="waste">Waste (%)</label>
      <input type="number" id="waste" value="7" step="1"/>
      <label>Total Area</label>
      <div><span id="totalSqft" class="chip mono">0.00 sq ft</span></div>
      <h3>Materials</h3>
      <label for="material">Vinyl</label>
      <select id="material"></select>
      <label for="laminate">Overlaminate</label>
      <select id="laminate"><option value="">None</option></select>
      <label for="markup">Markup √ó</label>
      <input type="number" id="markup" value="2.5" step="0.1"/>
      <div class="result" id="estimatorBreakdown">Fill area & materials to calculate</div>
    </section>

    <!-- LABOR -->
    <section id="labor" class="card" hidden>
      <h2>Labor & Add-Ons</h2>
      <label for="hourlyRate">Hourly Rate</label>
      <input type="number" id="hourlyRate" value="60"/>
      <label for="designTime">Design (hrs)</label>
      <input type="number" id="designTime"/>
      <label for="installTime">Install (hrs)</label>
      <input type="number" id="installTime"/>
      <div class="result" id="laborBreakdown">Enter labor info</div>
    </section>

    <!-- FINAL -->
    <section id="final" class="card" hidden>
      <h2>Final Quote</h2>
      <div class="final" id="finalBreakdown">Complete inputs to see final</div>
    </section>

    <!-- MATERIALS -->
    <section id="materials" class="card" hidden>
      <h2>Materials (Live from Google Sheets)</h2>
      <div id="materialsList" class="materials-list"></div>
      <div class="muted">Update your Google Sheet ‚Üí refresh this page to sync.</div>
    </section>
  </div>

  <script>
    // ---------- CONFIG ----------
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSRw1bG3LLKW223CQVAH2ENVPX4vlqpzUS5HHLRMedU5Jp6vmkpGul2CE6ij_EkVqh07EYg8gwZwTLI/pubhtml"; 
    let materials = [];

    // ---------- HELPERS ----------
    const $ = s => document.querySelector(s);
    const $$ = s => [...document.querySelectorAll(s)];
    function money(n){return new Intl.NumberFormat('en-CA',{style:'currency',currency:'CAD'}).format(n||0);}
    function toNum(el){return parseFloat(el?.value)||0;}

    // ---------- FETCH SHEET ----------
    async function fetchMaterials(){
      try{
        const resp = await fetch(SHEET_URL);
        const text = await resp.text();
        const lines = text.split(/\r?\n/).filter(l=>l.trim());
        const [header,...rows] = lines.map(r=>r.split(","));
        const idx = {}; header.forEach((h,i)=> idx[h.trim()] = i);
        materials = rows.map(r=>({
          name:r[idx.Name],
          type:r[idx.Type],
          length:parseFloat(r[idx.Length_ft]),
          width:parseFloat(r[idx.Width_in]),
          price:parseFloat(r[idx.Price_CAD])
        })).filter(m=>m.name);
        populateDropdowns(); renderMaterialsList(); recalc();
      }catch(err){console.error("Sheet fetch failed",err);}
    }

    // ---------- MATERIALS ----------
    function computeCostPerSqFt(m){return m.price/(m.length*(m.width/12));}
    function populateDropdowns(){
      $('#material').innerHTML=""; $('#laminate').innerHTML="<option value=''>None</option>";
      materials.forEach(m=>{
        const opt=document.createElement("option");
        opt.value=m.name;
        opt.textContent=`${m.name} (${money(computeCostPerSqFt(m))}/sq ft)`;
        if(m.type==="Vinyl") $('#material').appendChild(opt);
        if(m.type==="Overlaminate") $('#laminate').appendChild(opt);
      });
    }
    function renderMaterialsList(){
      const list=$('#materialsList'); list.innerHTML="";
      materials.forEach(m=>{
        list.innerHTML+=`<div><strong>${m.name}</strong> <span class="chip">${m.type}</span> - ${money(computeCostPerSqFt(m))}/sq ft</div>`;
      });
    }

    // ---------- DIMENSIONS ----------
    function addDimension(l=0,w=0){
      const row=document.createElement("div");
      row.className="row";
      row.innerHTML=`<input type="number" class="dimL" value="${l}"/> √ó <input type="number" class="dimW" value="${w}"/> in <button class="removeBtn">üóëÔ∏è</button>`;
      $('#dimensionList').appendChild(row);
      row.querySelectorAll("input").forEach(i=>i.addEventListener("input",recalc));
      row.querySelector(".removeBtn").onclick=()=>{row.remove();recalc();};
    }
    function clearDimensions(){ $('#dimensionList').innerHTML=""; addDimension(); recalc();}
    function calcSqFt(){
      let total=0; const bleed=toNum($('#bleed'))*2;
      $$('.dimL').forEach((l,i)=>{
        const w=$$('.dimW')[i]; const L=toNum(l)+bleed, W=toNum(w)+bleed;
        if(L>0&&W>0) total+=L*W;
      });
      return total/144*(1+toNum($('#waste'))/100);
    }

    // ---------- MODEL ----------
    function model(){
      const vinyl=materials.find(m=>m.name===$('#material').value);
      const lam=materials.find(m=>m.name===$('#laminate').value);
      const sqFt=calcSqFt();
      const markup=Math.max(1,toNum($('#markup')));
      const vClient=vinyl?computeCostPerSqFt(vinyl)*markup:0;
      const lClient=lam?computeCostPerSqFt(lam)*markup:0;
      const totalMatCost=(vinyl?computeCostPerSqFt(vinyl)*sqFt:0)+(lam?computeCostPerSqFt(lam)*sqFt:0);
      const totalClient=(vClient+lClient)*sqFt;
      const design=toNum($('#designTime')), install=toNum($('#installTime')), rate=toNum($('#hourlyRate'));
      const laborCharge=(design+install)*rate;
      return {sqFt,totalMatCost,totalClient,laborCharge};
    }

    // ---------- UI ----------
    function recalc(){
      const m=model();
      $('#totalSqft').textContent=`${m.sqFt.toFixed(2)} sq ft`;
      $('#estimatorBreakdown').innerHTML=`Client Material Charge: ${money(m.totalClient)}<br>Material Cost: ${money(m.totalMatCost)}`;
      $('#laborBreakdown').textContent=`Labor Charge: ${money(m.laborCharge)}`;
      $('#finalBreakdown').innerHTML=`<strong>Total:</strong> ${money(m.totalClient+m.laborCharge)}`;
    }

    // ---------- INIT ----------
    function init(){
      $('#addDimBtn').onclick=()=>addDimension();
      $('#clearDimBtn').onclick=clearDimensions;
      $$('#markup,#bleed,#waste,#hourlyRate,#designTime,#installTime').forEach(el=>el.addEventListener("input",recalc));
      $$('#material,#laminate').forEach(el=>el.addEventListener("change",recalc));

      function activateTab(tab){
        $$('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        ['estimator','labor','final','materials'].forEach(id=>{
          document.getElementById(id).hidden=id!==tab.dataset.tab;
        });
        $('#mobileMenu').classList.remove('show');
        $('#overlay').classList.remove('show');
        $('#hamburger').classList.remove('active');
        document.querySelector('.topbar h1').textContent = tab.textContent;
      }

      $$('.tab').forEach(tab=>tab.onclick=()=>activateTab(tab));
      $('#hamburger').onclick=()=>{
        $('#hamburger').classList.toggle('active');
        $('#mobileMenu').classList.toggle('show');
        $('#overlay').classList.toggle('show');
      };
      $('#overlay').onclick=()=>{
        $('#hamburger').classList.remove('active');
        $('#mobileMenu').classList.remove('show');
        $('#overlay').classList.remove('show');
      };

      addDimension(); fetchMaterials();
    }
    init();
  </script>
</body>
</html>
